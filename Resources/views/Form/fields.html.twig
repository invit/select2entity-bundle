{% block tetranz_select2entity_widget %}
    {% set attr = attr|merge({
        'data-multiple':multiple ? 1:0,
        'data-rpath':remote_path,
        'data-value':value,
        'data-min-length':minimum_input_length,
        'data-page-limit':page_limit,
        'data-data-type':data_type,
        'data-placeholder':placeholder
    }) %}

    {# Add class for jQuery for find it #}
    {% set attr = attr|merge({ 'class': (attr.class|default('') ~ ' select2entity')|trim }) %}

    {# A bit of a hack here.
    It seems to work more smoothly if we put the initial value into data-value rather than the value attribute.
    But ... value needs to be non-blank for initSelection in the js to fire.
    We need to remove this value in EntitiesToPropertyTransformer #}
    {% if form.vars.data is defined and form.vars.data.id is defined %}
        {% set value = form.vars.data.id %}
    {% else %}
        {% set value = 'x' %}
    {% endif %}

    {% set type = type|default('hidden') %}
    {{ block('form_widget_simple') }}
{% endblock %}
